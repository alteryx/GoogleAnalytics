<!--
Created by Stephen Wagner, 12/18/2015
Google Sheets Input GUI
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Google Sheets Input</title>
    <script type="text/javascript">
        // Include version 1 of the base GUI library.
        document.write('<link rel="import" href="' + window.Alteryx.LibDir + '1/lib/alteryx/gui/includes.html">');
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <style>
        .alignment_container {
            display: block;
            vertical-align: middle;
            padding: 4px 0;
            width:93%;
        }

        .alignment_container2 {
            display: block;
            vertical-align: middle;
            padding: 4px 0;
            width:70%;
        }

        .option_button {
            width: 100%;
            float: center;
            vertical-align: middle;
            table-layout: auto;
            border-collapse: collapse;
        }

        .option_button button {
            min-width: 116px;
            max-width: 116px;
            padding: 8px 12px 8px 12px;
            text-align: middle;
            margin: auto;
            display: block;
            float: left;
            border-color: rgb(22, 145, 198);
            background-color: rgb(22, 145, 198);
            color: rgb(255, 255, 255);
        }

        /* Warning message for selecting over 10 metrics */
        .tooMany:before {
            background-color: transparent;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid #FFE599;
            content: "\00a0";
            height: 0px;
            position: relative;
            top: -34px; /*** Change this to vertically offset the little triangle on top of the error bubble relative to the bubble itself. ***/
            width: 0px;
        }
        .tooMany {
            background-color: #FFFFFF;
            border: 1px solid #FFE599;
            border-radius: 5px;
            box-shadow: 0 2px 7px rgba(0, 0, 0, 0.65), 0 1px 0 #FFE599 inset;
            color: black;
            display: inline-block;
            font-family: 'Segoe UI', Arial, sans-serif;
            font-size: 1em;
            top: 5px; /*** change this to vertically offset the error bubble from the list box. ***/
            padding: 3px 5px 3px 5px;
            position: relative;
            float: center;
        }

        .alteryx-grid-text-cell {
            overflow:visible;
        }

        @media (max-width:407px) {
            .alignment_container {
                padding-left:5%;
                width:90%;
            }
            .alignment_container2 {
                padding-left: 5%;
                width:90%;
            }
        }
    </style>

</head>

<body>
<!-- 1st view - Online or Offline Mode -->
    <fieldset id="accessMethod" style="display:block">
        <legend>Google Analytics Credentials</legend>
        <table>
            <tr>
                <td>
                <button style="width:116px;" type="submit" id="onlineMode" onclick="login();">Online</button><br/><br/>
                Sign in using Google Account credentials. This option requires re-entering credentials every 60 minutes or any time a new workflow is opened.
                </td>
            </tr>
            <tr><td height="3"></td></tr>
            <tr>
                <td>
                <button style="width:116px;" type="submit" id="offlineMode" onclick="displayFieldset(['#offlineCreds']);">Offline</button><br/><br/>
                Sign in using API credentials. This option requires obtaining a Client ID, Secret, and Token and does not require re-entering credentials to run a workflow.
                </td>
            </tr>
        </table>
    </fieldset>

<!-- 1a view - Online credentials -->
    <fieldset id="onlineCreds" style="display:none">
        <br/>
        <br/>
        <br/>
        <a href="javascript:void(0)" onclick="displayFieldset(['#accessMethod']); myIFrame.location='https://www.google.com/accounts/Logout';">Change Login Credentials</a>
    </fieldset>

<!-- 1b view - Offline credentials -->
    <fieldset id="offlineCreds" style="display:none">
        <legend>Google Analytics Credentials</legend>
        <label for="dataItemClientID">Client ID</label>
        <alteryx-pluginwidget type="TextBox" id="dataItemClientID" dataName="client_id"></alteryx-pluginwidget>
        <br/>
        <label>Client Secret</label>
        <alteryx-pluginwidget type="TextBox" password="true" id="dataItemClientSecret" dataName="client_secret"></alteryx-pluginwidget>
        <br/>
        <label>Refresh Token</label>
        <alteryx-pluginwidget type="TextBox" password="true" id="dataItemRefreshToken" dataName="refresh_token"></alteryx-pluginwidget>
        <label></label>
        <div>
            <button type="submit" style="float: right" id="connect_button" onclick="setFreshAccessToken();">Connect</button>
        </div>
        <br/>
        <br/>
        <br/>
        <a href="javascript:void(0)" onclick="displayFieldset(['#accessMethod']); myIFrame.location='https://www.google.com/accounts/Logout';">Change Login Credentials</a>
    </fieldset>

<!-- Account/WebProperties/Profiles Selectors  -->
    <fieldset id="profileSelectors" style="display: show;">
        <legend>Select Account/Profile</legend>
        <label>Accounts Select</label>
        <alteryx-pluginwidget type="DropDown"  id="accountsList" dataName="accountsList"></alteryx-pluginwidget>
        <label>WebProperties Select</label>
        <alteryx-pluginwidget type="DropDown"  id="webPropertiesList" dataName="webPropertiesList"></alteryx-pluginwidget>
        <label>Profiles Select</label>
        <alteryx-pluginwidget type="DropDown"  id="profilesList" dataName="profilesList"></alteryx-pluginwidget>
        <div>
            <!-- Add id name and onclick function during process story -->
            <button type="submit" style="float: right" id="" onclick="noMetricsSelectedWarning();">Next</button>
            <button type="submit" style="float: right" id="" onclick="">Previous</button>
        </div>
    </fieldset>

<!-- Metrics fieldset -->
    <fieldset id="metrics" style="display:show"><!--Add a display:none during process story-->
        <legend>Select Metrics</legend>
        <alteryx-pluginwidget type="ListBox" datatype="MultiStringSelector"
          ismultiselect="true" issearchable="true" id="metricsList" dataName="metricsList" showsearchrow="true"></alteryx-pluginwidget>
        <div>
            <!-- Add id name and onclick function during process story -->
            <button type="submit" style="float: right" id="" onclick="noMetricsSelectedWarning();">Next</button>
            <button type="submit" style="float: right" id="" onclick="">Previous</button>
            <div id="maxMetrics"></div>
        </div>
    </fieldset>

<!-- Dimensions fieldset -->
    <fieldset id="dimensions" style="display:show"><!--Add a display:none during process story-->
        <legend>Select Dimensions</legend>
        <alteryx-pluginwidget type="ListBox" datatype="MultiStringSelector"
          ismultiselect="true" issearchable="true" id="dimensionsList" dataName="dimensionsList" showsearchrow="true"></alteryx-pluginwidget>
        <div>
            <!-- Add id name and onclick function during process story -->
            <button type="submit" style="float: right" id="" onclick="noDimensionsSelectedWarning();">Next</button>
            <button type="submit" style="float: right" id="" onclick="">Previous</button>
            <div id="maxDimensions"></div>
        </div>
    </fieldset>

<!-- fieldset for the non-captured fields -->
    <fieldset id="token" style="display:none">
        <alteryx-pluginwidget type="TextBox" id="dataItemAccessToken" dataName="accessToken"></alteryx-pluginwidget>
        <alteryx-pluginwidget type="TextBox" id="dataItemView" dataName="view"></alteryx-pluginwidget>

        <a href="#" style="display:none" id="logoutText" target='myIFrame' onclick="myIFrame.location='https://www.google.com/accounts/Logout';"></a>
        <iframe name='myIFrame' id="myIFrame" style='display:none'></iframe>
    </fieldset>

<!-- API error messaging -->
    <div id="connectionStatusBox" style="display:none">
        <div id="connectionStatus" class="button_alignment_container"></div>
    </div>

    <div id="app">
    </div>
<script type="text/javascript" src='bundle.js'>
</script>
</body>
